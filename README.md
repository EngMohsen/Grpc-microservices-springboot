# Grpc microservices springboot

## Intoduction
Simple microservices (helloworld, UserRegistration) in spring boot and all microservices are communicated with each other using RPC. logs display on kibana for user to monitor the application.

## Feature
* Microservices should communicate with each other using GRPC.
* Microservices  generate some logs and collected/aggregated using Logstash and push to Elastic Search and end user can monitor those logs using Kibana.
* Gateway microservice has endpoints using GraphQL & REST which can access some static data from other microservices and those endpoints can be testable using postman or other tools.
* Microservices are deployed using docker, minikube. we can test the mircroservices locally using postman or any other tool.

## Architechture
![task](https://user-images.githubusercontent.com/9844631/141376227-c3d91cb3-78c7-4658-9b0d-f465a4d610a3.png)

## Prerequisites
To be able to run and use the application you should have the below with the right version
* Java 11
* maven 3.8.2
* docker
* minikube

## Architecture

In this application we have 2 microservice (helloworld, Userregistration) and they Automatically configures and runs the gRPC server with  @GrpcService implementations. we have a gateway which has endpoints to access data from these 2 microservices and it creates and manages  grpc channels and stubs with @GrpcClient.

In this application we have 4 modules working behind the scene as 
* The interface project Contains the raw protobuf files and generates the java model and service classes. You probably share this part.
* The 2 server project (Helloworld , Userregister) Contains the actual implementation of your project and uses the interface project as dependency.
* The client projects (optional and possibly many) Any client projects that use the pre-generated stubs to access the server.

![image](https://user-images.githubusercontent.com/9844631/141380110-06f7efcf-619e-4dc2-9a34-1c204d7ae7a9.png)

In the gateway has endpoints using GraphQL & REST which can access some static data from other microservices and those endpoints can be testable using postman or other tools.

All these module are containerized and deployed by docker and minikube by kubernetes.

## Deployment Instrucation
In this project we have 2 batch files one to build and start the application and one for cleaing and stop the application
* start.sh -> Batch file is used to clean and deploy the applications in docker
````script
#!/bin/bash
mvn clean install
docker-compose -f docker-compose-ELK.yml up --build
````
* stop.sh -> Batch file is used to clean up and stop the applications in docker
````script
#!/bin/bash
docker-compose -f docker-compose-ELK.yml down
mvn clean
````
## Configuration
Since we use docker and springboot in this application ,so everything is configurable and we configure the main parameters of the applciation in .env file which loaded during doplying the application and set the values in springboot configuration file (application.properties)
````properties
HELLOWORLD_PORT=5050
USER_PORT=6060
HELLO_URL=helloworld:5050
USER_URL=userregister:6060
GATEWAY_PORT=8080
````
## Services 
We have 3 services and we will add more in the future
* helloWorld -> service which takes a name and returns Hello : Name
* Register -> user register in our application and save in Map 
* getUser -> retrieve user info by user Id. 

## Test
After the deployment you can test the application by using (https://localhost:8080/graphiql) based on the configuration

* HelloWorld
![image](https://user-images.githubusercontent.com/9844631/141382334-21120f55-8adb-496f-b841-55e6f76e0143.png)
* Register
 ![image](https://user-images.githubusercontent.com/9844631/141382495-cc63a04b-5f27-431f-8464-822ef5653ef0.png)
* Get User details
![image](https://user-images.githubusercontent.com/9844631/141382625-dd48dfc7-6346-4432-b5b0-d18d8687b239.png)

## Monitoring
As I mentioned the logs of the microservices have been collected and aaggregated using Logstash and push to Elastic Search and end user can monitor those logs using Kibana.

You can access kibana by using (http://localhost:5601/) but you need to create an index from the template which is generated by logstash

![image](https://user-images.githubusercontent.com/9844631/141382878-9c4372ac-be60-4eeb-b5ec-67b24bb8ee5e.png)

## Enhancement
* Adding Nosql DB like (cassandra,MongoDb)
* Building pipeline to automate the deployment process to cloud.
* Running ELK by Kubernetes. 





